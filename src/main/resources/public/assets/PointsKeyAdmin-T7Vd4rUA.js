import{l as se,j as oe,k as ie,m as ne,t as ue}from"./main-kPxSAhoX.js";import{u as re,k as de,l as f,c as z,A as T,C as P,D as j,B as r,y as O,E as A}from"./naive-ui-DI5taouS.js";import{f as ve,t as M,j as pe,P as me,d as l,L as o,M as fe,N as u,p as v,R as ye,h as ce}from"./@vue/runtime-core-HkD_qmHb.js";import{o as ge,u as n,D as a}from"./@vue/reactivity-u6ABGPMg.js";import{J as be}from"./@vue/shared-B44ZMsZr.js";import"./@vue/runtime-dom-hKZGlRKN.js";import"./vue-l5MwoWad.js";import"./iconify-Dow0D7fd.js";import"./axios-B9ygI19o.js";import"./index-Sc79Mvov.js";/* empty css                               *//* empty css                                   */import"./@iconify-icons/mdi-DHJ9wI3J.js";import"./@iconify-icons/material-symbols-ysi_2Ggx.js";import"./@iconify-icons/ph-Cp5BnHKQ.js";import"./@iconify-icons/solar-D92Mec1c.js";import"./date-fns-Ddv6U-Yp.js";import"./vooks-CHP5O5D0.js";import"./evtd-CI_DDEu_.js";import"./seemly-D48R1BPg.js";import"./lodash-es-Bym2J9Gs.js";import"./@emotion/hash-WldOFDRm.js";import"./vueuc-CfobdMGE.js";import"./@css-render/vue3-ssr-Dz-R1Ori.js";import"./vdirs-DRH9Xvnd.js";import"./@juggle/resize-observer-C8OzoCMD.js";import"./css-render-CKtry55Z.js";import"./treemate-HRdUPn5m.js";import"./date-fns-tz-7ws4grit.js";import"./async-validator-9PlIezaS.js";import"./@css-render/plugin-bem-Be8eOoM-.js";const ke={class:"flex-1 overflow-y-auto p-4 space-y-4"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},xe={class:"col-span-1 md:col-span-2 flex items-start gap-3"},Ce={class:"flex gap-2 justify-end mt-2"},Ne={class:"flex items-center justify-between mb-2"},Te={class:"flex items-center gap-2"},Pe={class:"text-xs text-neutral-500"},Ue={class:"flex items-center gap-2"},De={class:"mt-2 flex justify-end"},Ie={class:"flex gap-2 mb-2 items-center"},Se={class:"mt-2 flex justify-end"},ut=ve({__name:"PointsKeyAdmin",setup(Ke){const d=re(),i=ge({name:"",permanentPoints:0,subscribePoints:0,subscribeType:"MONTHLY",subscribeDurationDays:0,validFrom:null,validTo:null}),U=n(10),E=M(()=>(i.name||"").trim().length>0),$=[{label:"MONTHLY",value:"MONTHLY"},{label:"YEARLY",value:"YEARLY"},{label:"TRIAL",value:"TRIAL"}];async function H(){try{const t={...i};t.validFrom&&(t.validFrom=new Date(t.validFrom).toISOString()),t.validTo&&(t.validTo=new Date(t.validTo).toISOString());const e=await ie(t);b.value=e.id,await m(),d.success("配置已保存")}catch(t){d.error((t==null?void 0:t.message)||"保存失败")}}async function V(){try{const t=b.value;if(!t){d.warning("请先选择配置或保存配置");return}await ne(t,U.value),d.success("密钥生成成功"),await p()}catch(t){d.error((t==null?void 0:t.message)||"生成失败")}}const F=n([]),g=n([]),_=[{type:"selection"},{title:"ID",key:"id",width:80},{title:"Key",key:"keyCode"},{title:"配置快照",key:"configJson"},{title:"可用",key:"enabled"},{title:"已使用",key:"used"},{title:"使用时间",key:"usedTime"},{title:"使用IP",key:"usedIp"},{title:"使用UID",key:"usedUid"}],c=n(1),D=n(10),L=n(0),I=n(""),S=n("desc");function q(t){g.value=(t||[]).map(e=>Number(e))}async function B(t){try{await ue(g.value,t),d.success(t?"已启用选中密钥":"已禁用选中密钥"),await p()}catch(e){d.error((e==null?void 0:e.message)||"操作失败")}}async function p(){try{const t=await se({page:c.value,size:D.value,key:I.value.trim()||void 0,order:S.value});F.value=t.items||[],L.value=Number(t.total||0)}catch(t){d.error((t==null?void 0:t.message)||"加载失败")}}function J(){c.value=1,p()}function G(t){c.value=t,p()}function Q(t){D.value=t,c.value=1,p()}const K=n([]),b=n(null),y=n(1),k=n(10),R=n(0),w=n(""),x=n("id"),C=n("desc"),W=[{label:"按ID",value:"id"},{label:"按开始时间",value:"start"},{label:"按结束时间",value:"end"}],Y=[{label:"升序",value:"asc"},{label:"降序",value:"desc"}],X=[{title:"ID",key:"id",width:80},{title:"名称",key:"name"},{title:"永久积分",key:"permanentPoints"},{title:"订阅积分",key:"subscribePoints"},{title:"订阅类型",key:"subscribeType"},{title:"订阅天数",key:"subscribeDurationDays"},{title:"开始时间",key:"validFrom"},{title:"结束时间",key:"validTo"},{title:"禁用",key:"disabled"},{title:"操作",key:"action",render(t){return ce(r,{size:"small",onClick:()=>Z(t)},{default:()=>"选择"})}}];function Z(t){b.value=Number(t.id)}const h=M(()=>{const t=b.value;if(!t)return"未选择";const e=K.value.find(N=>Number(N.id)===t);return e?`${e.id} / ${e.name}`:String(t)});async function m(){try{const t=await oe({page:y.value,size:k.value,name:w.value.trim()||void 0,sortBy:x.value,order:C.value});K.value=t.items||[],R.value=Number(t.total||0)}catch(t){d.error((t==null?void 0:t.message)||"加载配置失败")}}function ee(){y.value=1,m()}function te(){w.value="",x.value="id",C.value="desc",y.value=1,k.value=10,m()}function le(t){y.value=t,m()}function ae(t){k.value=t,y.value=1,m()}return pe(async()=>{await m(),await p()}),(t,e)=>{const N=ye("n-pagination");return fe(),me("div",ke,[l(a(O),{title:"生成密钥配置"},{default:o(()=>[l(a(de),{model:i},{default:o(()=>[u("div",we,[l(a(f),{label:"配置名称"},{default:o(()=>[l(a(z),{value:i.name,"onUpdate:value":e[0]||(e[0]=s=>i.name=s),placeholder:"如：新春活动礼包"},null,8,["value"])]),_:1}),u("div",xe,[l(a(f),{class:"flex-1",label:"永久积分"},{default:o(()=>[l(a(T),{value:i.permanentPoints,"onUpdate:value":e[1]||(e[1]=s=>i.permanentPoints=s),precision:2,min:"0"},null,8,["value"])]),_:1}),l(a(f),{class:"flex-1",label:"订阅积分"},{default:o(()=>[l(a(T),{value:i.subscribePoints,"onUpdate:value":e[2]||(e[2]=s=>i.subscribePoints=s),precision:2,min:"0"},null,8,["value"])]),_:1})]),l(a(f),{class:"max-w-[220px]",label:"订阅类型"},{default:o(()=>[l(a(P),{value:i.subscribeType,"onUpdate:value":e[3]||(e[3]=s=>i.subscribeType=s),options:$,class:"w-[200px]"},null,8,["value"])]),_:1}),l(a(f),{label:"订阅时长（天）"},{default:o(()=>[l(a(T),{value:i.subscribeDurationDays,"onUpdate:value":e[4]||(e[4]=s=>i.subscribeDurationDays=s),precision:0,min:"0"},null,8,["value"])]),_:1}),l(a(f),{label:"开始时间"},{default:o(()=>[l(a(j),{value:i.validFrom,"onUpdate:value":e[5]||(e[5]=s=>i.validFrom=s),placeholder:"选择开始时间",type:"datetime"},null,8,["value"])]),_:1}),l(a(f),{label:"结束时间"},{default:o(()=>[l(a(j),{value:i.validTo,"onUpdate:value":e[6]||(e[6]=s=>i.validTo=s),placeholder:"选择结束时间",type:"datetime"},null,8,["value"])]),_:1})]),u("div",Ce,[l(a(r),{onClick:H},{default:o(()=>[...e[15]||(e[15]=[v("保存配置",-1)])]),_:1}),l(a(r),{disabled:!E.value,type:"primary",onClick:V},{default:o(()=>[...e[16]||(e[16]=[v("生成密钥",-1)])]),_:1},8,["disabled"]),l(a(T),{value:U.value,"onUpdate:value":e[7]||(e[7]=s=>U.value=s),precision:0,max:"200",min:"1"},null,8,["value"])])]),_:1},8,["model"])]),_:1}),l(a(O),{title:"配置列表"},{default:o(()=>[u("div",Ne,[u("div",Te,[u("div",Pe,"当前选择："+be(h.value),1),l(a(z),{value:w.value,"onUpdate:value":e[8]||(e[8]=s=>w.value=s),placeholder:"按名称查询",style:{width:"180px"}},null,8,["value"]),l(a(P),{value:x.value,"onUpdate:value":e[9]||(e[9]=s=>x.value=s),options:W,style:{width:"140px"}},null,8,["value"]),l(a(P),{value:C.value,"onUpdate:value":e[10]||(e[10]=s=>C.value=s),options:Y,style:{width:"120px"}},null,8,["value"]),l(a(r),{onClick:ee},{default:o(()=>[...e[17]||(e[17]=[v("查询",-1)])]),_:1})]),u("div",Ue,[l(a(r),{onClick:te},{default:o(()=>[...e[18]||(e[18]=[v("重置",-1)])]),_:1}),l(a(r),{onClick:m},{default:o(()=>[...e[19]||(e[19]=[v("刷新配置",-1)])]),_:1})])]),l(a(A),{columns:X,data:K.value,"row-key":s=>s.id},{empty:o(()=>[...e[20]||(e[20]=[u("div",{class:"py-8 text-center text-neutral-500"},"暂无配置",-1)])]),_:1},8,["data","row-key"]),u("div",De,[l(N,{"item-count":R.value,page:y.value,"page-size":k.value,"onUpdate:page":le,"onUpdate:pageSize":ae},null,8,["item-count","page","page-size"])])]),_:1}),l(a(O),{title:"密钥列表"},{default:o(()=>[u("div",Ie,[l(a(z),{value:I.value,"onUpdate:value":e[11]||(e[11]=s=>I.value=s),placeholder:"按Key查询",style:{width:"200px"}},null,8,["value"]),l(a(P),{value:S.value,"onUpdate:value":e[12]||(e[12]=s=>S.value=s),options:Y,style:{width:"120px"}},null,8,["value"]),l(a(r),{onClick:J},{default:o(()=>[...e[21]||(e[21]=[v("查询",-1)])]),_:1}),l(a(r),{disabled:g.value.length===0,onClick:e[13]||(e[13]=s=>B(!0))},{default:o(()=>[...e[22]||(e[22]=[v("批量启用",-1)])]),_:1},8,["disabled"]),l(a(r),{disabled:g.value.length===0,onClick:e[14]||(e[14]=s=>B(!1))},{default:o(()=>[...e[23]||(e[23]=[v("批量禁用",-1)])]),_:1},8,["disabled"]),l(a(r),{onClick:p},{default:o(()=>[...e[24]||(e[24]=[v("刷新",-1)])]),_:1})]),l(a(A),{columns:_,data:F.value,"row-key":s=>s.id,"onUpdate:checkedRowKeys":q},{empty:o(()=>[...e[25]||(e[25]=[u("div",{class:"py-8 text-center text-neutral-500"},"暂无数据",-1)])]),_:1},8,["data","row-key"]),u("div",Se,[l(N,{"item-count":L.value,page:c.value,"page-size":D.value,"onUpdate:page":G,"onUpdate:pageSize":Q},null,8,["item-count","page","page-size"])])]),_:1})])}}});export{ut as default};
