<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
          name="viewport"/>
    <title>Coralsum 生图</title>
    <link href="/favicon.svg?v=3" rel="icon" sizes="any" type="image/svg+xml"/>
    <meta content="#ffffff" media="(prefers-color-scheme: light)" name="theme-color"/>
    <meta content="#0b0b0b" media="(prefers-color-scheme: dark)" name="theme-color"/>
    <script>
        (function applyEarlyDark() {
            try {
                var html = document.documentElement
                var raw = localStorage.getItem('pinia_settings')
                var saved = null
                if (raw) {
                    try {
                        saved = JSON.parse(raw || '{}')
                    } catch {
                    }
                }
                var hasSavedDark = saved && typeof saved.darkMode !== 'undefined'
                if (hasSavedDark) {
                    var darkSaved = !!saved.darkMode
                    html.classList.toggle('dark', darkSaved)
                } else {
                    var isDark = !!(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)
                    html.classList.toggle('dark', isDark)
                    var seed = saved && typeof saved === 'object' ? saved : {}
                    seed.darkMode = isDark
                    try {
                        localStorage.setItem('pinia_settings', JSON.stringify(seed))
                    } catch {
                    }
                }
            } catch {
            }
        })()
    </script>

</head>
<body>
<div id="app"></div>
<style>
    html.preload-block #app {
        opacity: 0;
    }

    html.preload-block, html.preload-block body {
        background: var(--pl-base);
    }

    :root {
        --pl-base: #ffffff;
        --pl-bg1: rgba(59, 130, 246, 0.14);
        --pl-bg2: rgba(236, 72, 153, 0.16);
        --pl-bg3: rgba(99, 102, 241, 0.14);
        --pl-text: #111827;
        --pl-dot1: #3b82f6;
        --pl-dot2: #ec4899;
        --pl-dot3: #6366f1
    }

    .dark {
        --pl-base: #0b0b0b;
        --pl-bg1: rgba(59, 130, 246, 0.20);
        --pl-bg2: rgba(236, 72, 153, 0.22);
        --pl-bg3: rgba(99, 102, 241, 0.20);
        --pl-text: #e5e7eb;
        --pl-dot1: #60a5fa;
        --pl-dot2: #f472b6;
        --pl-dot3: #818cf8
    }

    .preload-overlay {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 12px;
        background: radial-gradient(1000px 400px at 20% 0%, var(--pl-bg1), transparent 60%),
        radial-gradient(800px 300px at 80% 20%, var(--pl-bg2), transparent 60%),
        radial-gradient(900px 500px at 50% 90%, var(--pl-bg3), transparent 60%);
        background-color: var(--pl-base);
        color: var(--pl-text)
    }

    .brand {
        position: relative;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        font-weight: 600;
        font-size: clamp(28px, 9vw, 84px);
        letter-spacing: 0.02em;
        color: var(--pl-text);
    }

    .brand::after {
        content: attr(data-text);
        position: absolute;
        inset: 0;
        color: var(--pl-base);
        filter: blur(3px);
        opacity: .55;
        pointer-events: none;
        -webkit-mask-image: linear-gradient(135deg, transparent 0 42%, #000 46% 54%, transparent 58% 100%);
        -webkit-mask-size: 170% 170%;
        -webkit-mask-repeat: no-repeat;
        -webkit-mask-position: var(--mask-pos, 0% 50%);
        transition: -webkit-mask-position var(--mask-dur, 1200ms) ease-in-out;
    }

    @supports not (-webkit-mask-image: linear-gradient(white, black)) {
        .brand::after {
            display: none;
        }
    }

    .brand .letter {
        display: inline-block;
        opacity: 0;
        transform: translateY(8px);
    }

    .brand .letter:nth-child(3n+1) {
        color: var(--pl-dot1);
    }

    .brand .letter:nth-child(3n+2) {
        color: var(--pl-dot2);
    }

    .brand .letter:nth-child(3n+3) {
        color: var(--pl-dot3);
    }

    @keyframes letter-in {
        0% {
            opacity: 0;
            transform: translateY(8px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes letter-out {
        0% {
            opacity: 1;
            transform: translateY(0);
        }
        100% {
            opacity: 0;
            transform: translateY(-6px);
        }
    }
</style>
<div id="preload-overlay" class="preload-overlay">
    <div class="brand" data-text="Coralsum">Coralsum</div>

</div>
<script>
    (function () {
        var overlay = document.getElementById('preload-overlay')
        var brand = overlay && overlay.querySelector('.brand[data-text]')
        if (!brand) return
        var text = brand.getAttribute('data-text') || brand.textContent || ''
        brand.textContent = ''
        var letters = []
        for (var i = 0; i < text.length; i++) {
            var s = document.createElement('span')
            s.className = 'letter'
            s.textContent = text[i]
            brand.appendChild(s)
            letters.push(s)
        }

        var step = 90, inDur = 360, outDur = 320, hold = 650, gap = 900, sweepDur = 1200
        var forward = true

        function runCycle() {
            if (!overlay || overlay.style.display === 'none') return
            // reset letters
            for (var i = 0; i < letters.length; i++) {
                var el = letters[i]
                el.style.animation = 'none'
                el.style.opacity = '0'
                el.style.transform = 'translateY(8px)'
                // force reflow to restart
                void el.offsetWidth
            }
            // sweep start/end
            brand.style.setProperty('--mask-dur', sweepDur + 'ms')
            brand.style.setProperty('--mask-pos', (forward ? '0% 50%' : '100% 50%'))
            // next frame move to other side
            requestAnimationFrame(function () {
                brand.style.setProperty('--mask-pos', (forward ? '100% 50%' : '0% 50%'))
            })

            var len = letters.length
            var inTotal = inDur + step * (len - 1)
            var outBase = inTotal + hold
            // appear from one side
            for (var i = 0; i < len; i++) {
                var idx = forward ? i : (len - 1 - i)
                var el = letters[idx]
                el.style.animation = 'letter-in ' + inDur + 'ms ease-out ' + (i * step) + 'ms forwards, '
                    + 'letter-out ' + outDur + 'ms ease-in ' + (outBase + (forward ? (len - 1 - i) : i) * step) + 'ms forwards'
            }

            // schedule next cycle reverse with gap
            var cycleTotal = outBase + outDur + step * (len - 1) + gap
            setTimeout(function () {
                forward = !forward;
                runCycle()
            }, cycleTotal)
        }

        runCycle()
    })()
</script>
<script type="module">
    const html = document.documentElement
    html.classList.add('preload-block')
    try {
        const raw = localStorage.getItem('pinia_settings')
        if (raw) {
            const saved = JSON.parse(raw || '{}')
            const dark = !!saved?.darkMode
            html.classList.toggle('dark', dark)
        }
    } catch {
    }

    async function waitFonts() {
        try {
            if ('fonts' in document && document.fonts && typeof document.fonts.load === 'function') {
                await Promise.all([
                    document.fonts.load('500 1em "Geist Mono"'),
                    document.fonts.load('400 1em "JetBrains Mono"'),
                    document.fonts.load('500 1em "JetBrains Mono"'),
                    document.fonts.load('600 1em "JetBrains Mono"')
                ])
            } else if (document.fonts && typeof document.fonts.ready?.then === 'function') {
                await document.fonts.ready
            }
        } catch {
        }
    }

    function waitStyles() {
        return new Promise(resolve => {
            const links = new Set()
            let errored = new Set()
            const done = () => {
                obs.disconnect();
                resolve(undefined)
            }

            function track(link) {
                if (link && link.rel === 'stylesheet') {
                    links.add(link)
                    if (!link.sheet) {
                        link.addEventListener('load', check, {once: true})
                        link.addEventListener('error', () => {
                            errored.add(link);
                            check()
                        }, {once: true})
                    }
                }
            }

            function check() {
                for (const l of links) {
                    if (!l.sheet && !errored.has(l)) return
                }
                done()
            }

            document.head.querySelectorAll('link[rel="stylesheet"]').forEach(track)
            const obs = new MutationObserver(muts => {
                for (const m of muts) {
                    m.addedNodes.forEach(n => {
                        if (n.nodeType === 1 && n.tagName === 'LINK') track(n)
                    })
                }
                check()
            })
            obs.observe(document.head, {childList: true})
            check()
        })
    }

    async function bootstrap() {
        const appImport = import('/src/main.ts').catch(e => console.error('app import failed', e))
        const stylesReady = waitStyles()
        await Promise.allSettled([appImport, stylesReady])
        await waitFonts().catch(e => console.error('fonts wait failed', e))
        const overlay = document.getElementById('preload-overlay')
        if (overlay) overlay.style.display = 'none'
        html.classList.remove('preload-block')
    }

    bootstrap()
</script>
</body>
</html>
