const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ImageGen-DDfivgcX.js","./@vue/runtime-dom-hKZGlRKN.js","./@vue/runtime-core-HkD_qmHb.js","./@vue/reactivity-u6ABGPMg.js","./@vue/shared-B44ZMsZr.js","./iconify-Dow0D7fd.js","./naive-ui-DI5taouS.js","./date-fns-Ddv6U-Yp.js","./vooks-CHP5O5D0.js","./evtd-CI_DDEu_.js","./seemly-D48R1BPg.js","./lodash-es-Bym2J9Gs.js","./@emotion/hash-WldOFDRm.js","./vueuc-CfobdMGE.js","./@css-render/vue3-ssr-Dz-R1Ori.js","./vdirs-DRH9Xvnd.js","./@juggle/resize-observer-C8OzoCMD.js","./css-render-CKtry55Z.js","./treemate-HRdUPn5m.js","./date-fns-tz-7ws4grit.js","./async-validator-9PlIezaS.js","./@css-render/plugin-bem-Be8eOoM-.js","./vue-l5MwoWad.js","./axios-B9ygI19o.js","./index-Sc79Mvov.js","./@iconify-icons/mdi-DHJ9wI3J.js","./@iconify-icons/material-symbols-ysi_2Ggx.js","./@iconify-icons/ph-Cp5BnHKQ.js","./@iconify-icons/solar-D92Mec1c.js","./ImageGen-BBok2Lgz.css","./@fontsource/geist-mono-CnUhxw1J.css","./@fontsource/jetbrains-mono-DllM3DPJ.css","./Register-dd-lfQmL.js","./ForgotPassword-Cc4WprUU.js","./PointsKeyAdmin-T7Vd4rUA.js"])))=>i.map(i=>d[i]);
import{w as ot,T as De,c as nt}from"./@vue/runtime-dom-hKZGlRKN.js";import{d as Oe,u as qe,a as Be,c as rt,b as it,e as lt}from"./vue-l5MwoWad.js";import{I as y,a as $}from"./iconify-Dow0D7fd.js";import{a as ut}from"./axios-B9ygI19o.js";import{u as Le,B as k,N as Ae,a as re,b as ne,c as oe,d as Ve,e as ze,f as je,g as dt,h as ct,i as mt,j as ft,k as pt,l as Ee,m as gt,n as vt,o as ht,z as yt,p as bt,q as wt}from"./naive-ui-DI5taouS.js";import{f as Me,t as ce,w as ge,j as Fe,K as W,L as u,M as _,N as r,d as i,O as q,P as E,p as L,F as we,Q as Re,R as xt}from"./@vue/runtime-core-HkD_qmHb.js";import{J as j,q as kt}from"./@vue/shared-B44ZMsZr.js";import{u as w,D as e,o as _t}from"./@vue/reactivity-u6ABGPMg.js";import{_ as $e}from"./index-Sc79Mvov.js";/* empty css                               *//* empty css                                   */import{d as $t,a as Pt,b as St,c as Rt,e as Ct,f as Mt,g as It,h as Lt,i as At,j as Tt,k as Ut,l as Nt,m as zt,n as jt,o as Et,p as Dt,q as Ot,r as qt,s as Bt,t as Vt,u as Ft,v as Wt,w as Ht,x as Xt,y as Kt,z as Gt}from"./@iconify-icons/mdi-DHJ9wI3J.js";import{d as Yt}from"./@iconify-icons/material-symbols-ysi_2Ggx.js";import{d as Zt,a as Jt,b as Qt,c as es,e as ts,f as ss,g as as}from"./@iconify-icons/ph-Cp5BnHKQ.js";import{d as os}from"./@iconify-icons/solar-D92Mec1c.js";function ns({store:t}){if(t.$id==="history")return;const o=`pinia_${t.$id}`,n=localStorage.getItem(o);if(n)try{t.$patch(JSON.parse(n))}catch{}t.$subscribe((a,c)=>{localStorage.setItem(o,JSON.stringify(c))})}const ie=Oe("user",{state:()=>({uid:"",permissions:[],name:"",nickTag:0,points:0,permanentPoints:0,subscribePoints:0,tier:"FREE",email:"",token:"",profileReady:!1,showLoginModal:!1,showProfileModal:!1}),actions:{init(){},setName(t){this.name=t,this.profileReady=!0},setTier(t){this.tier=t},addPoints(t){this.points+=t},setProfile(t){t.uid&&(this.uid=t.uid),Array.isArray(t.permissions)&&(this.permissions=t.permissions),this.email=t.email,this.name=t.name,(typeof t.nickTag=="number"||t.nickTag===null)&&(this.nickTag=t.nickTag??null),typeof t.points=="number"&&(this.points=t.points),this.permanentPoints=t.permanentPoints??this.permanentPoints,this.subscribePoints=t.subscribePoints??this.subscribePoints,this.tier=t.tier,t.token&&t.token.length>0&&(this.token=t.token),this.profileReady=!0,this.showLoginModal=!1,this.showProfileModal=!1},requireLogin(){this.showLoginModal=!0},requireProfile(){this.showProfileModal=!0},logout(){try{localStorage.removeItem("pinia_user")}catch{}this.$reset(),this.showLoginModal=!0}}}),B=ut.create({baseURL:"/api",timeout:1e3*60*4});B.interceptors.request.use(t=>{const o=ie();return o!=null&&o.token&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${o.token}`),t});B.interceptors.response.use(t=>{const{status:o,data:n}=t;if(o<200||o>=300)return Promise.reject(t);if(n&&typeof n=="object"){const a=n.status;if(typeof a=="number"&&a>=400){const c=n.message,f=ie();return(a===401||a===403)&&(f.token="",f.requireLogin()),Promise.reject({status:a,message:c})}}if(n&&typeof n=="object"&&"code"in n){const a=n.code,c=n.message,f=n.data;if(a!=="SUCCESS"){const A=ie();return(a==="UNAUTHORIZED"||a==="FORBIDDEN")&&(A.token="",A.requireLogin()),Promise.reject({code:a,message:c,data:f})}t.data=f}return t},t=>{var a;const o=ie(),n=(a=t==null?void 0:t.response)==null?void 0:a.status;return(n===401||n===403)&&(o.token="",o.requireLogin()),Promise.reject(t)});async function rs(t,o){const{data:n}=await B.post("/auth/send-code",{email:t,purpose:o});return n}async function is(t,o){const{data:n}=await B.post("/auth/login",{username:t,password:o});return n}async function Pe(){const{data:t}=await B.get("/web/profile",{headers:{"X-API-Version":"v1"}});return{uid:t.uid,permissions:Array.isArray(t.permissions)?t.permissions:[],name:t.nick_name,nickTag:typeof t.nick_tag=="number"?t.nick_tag:null,email:t.source_code,tier:t.tier,permanentPoints:Number(t.permanent_points||0),subscribePoints:Number(t.subscribe_points||0),points:Number(t.permanent_points||0)+Number(t.subscribe_points||0)}}async function ls(){return await Pe()}async function us(t){const o={"X-API-Version":"v1"},{data:n}=await B.put("/web/profile",{nick_name:t},{headers:o});return{uid:n.uid,permissions:Array.isArray(n.permissions)?n.permissions:[],name:n.nick_name,nickTag:typeof n.nick_tag=="number"?n.nick_tag:null,email:n.source_code,tier:n.tier,permanentPoints:Number(n.permanent_points||0),subscribePoints:Number(n.subscribe_points||0),points:Number(n.permanent_points||0)+Number(n.subscribe_points||0)}}async function ds(t,o,n,a){const{data:c}=await B.post("/user/change-password",{email:t,oldPassword:o,newPassword:n,code:a});return c}async function Ao(t){const o=new FormData;if(Array.isArray(t.inputImages)&&t.inputImages.length>0)for(const b of t.inputImages)b&&o.append("image",b,b.name||"image");o.append("text",t.prompt),t.systemPrompt&&o.append("system",t.systemPrompt);const a={"1:1":"R1_1","2:3":"R2_3","3:2":"R3_2","3:4":"R3_4","4:3":"R4_3","9:16":"R9_16","16:9":"R16_9","21:9":"R21_9"}[t.config.aspectRatio];a&&o.append("aspectRatio",a),o.append("candidateCount",String(t.config.candidateRadio));const c=Math.max(0,Math.min(2,t.config.temperature)),f=Math.max(0,Math.min(1,t.config.topP));o.append("temperature",String(c)),o.append("topP",String(f)),o.append("format",t.config.outputFormat);const R={"1x":"X1","2x":"X2","3x":"X3","4x":"X4"}[t.config.resolution];R&&o.append("upscaylScale",R);const P={"1K":"X1","2K":"X2","4K":"X4"}[t.config.imageSize];P&&o.append("imageSize",P);const U={auto:"AUTO",low:"LOW",medium:"MEDIUM",high:"HIGH"}[t.config.mediaResolution];U&&o.append("mediaResolution",U);const x=ie(),z={"X-API-Version":"v1"};x!=null&&x.token&&(z.Authorization=`Bearer ${x.token}`),await B.post("/generative-image/submit-task",o,{headers:z});const N=1500,S=Math.ceil(1e3*60*5/N);for(let b=0;b<S;b++){await new Promise(I=>setTimeout(I,N));const{data:C}=await B.get("/generative-image/get-task-result",{headers:z}),O=C==null?void 0:C.status;if(O==="COMPLETED"){const I=(C==null?void 0:C.result)||{};return{durationMs:I.duration_ms??I.durationMs,inputTokens:I.input_tokens??I.inputTokens,outputTokens:I.output_tokens??I.outputTokens,images:I.images||[],text:I.text,linkImages:I.link_images??I.linkImages??[]}}if(O==="FAILED")throw{message:"生成任务失败",status:500};if(O==="NONE")throw{message:"任务不存在或已失效",status:400}}throw{message:"生成超时，请稍后重试",status:504}}async function To(t){const o={"X-API-Version":"v1","Content-Type":"text/plain"},n=ie();n!=null&&n.token&&(o.Authorization=`Bearer ${n.token}`);const{data:a}=await B.post("/generative-image/assess-intent",t,{headers:o});return{generateIntent:a.generate_intent,guideMessage:a.guide_message}}async function Uo(t,o){const n={"X-API-Version":"v1"};try{const f=ie();f!=null&&f.token&&(n.Authorization=`Bearer ${f.token}`)}catch{}const a={ref:t};typeof o=="boolean"&&(a.darkMode=o);const{data:c}=await B.get("/generative-image/link",{params:a,headers:n});if(c&&typeof c=="object"){const f=c.url??c.link??"";return String(f||"")}return String(c||"")}async function No(t,o,n){const{data:a}=await B.post("/auth/register",{email:t,password:o,code:n});return a}async function zo(t,o,n){const{data:a}=await B.post("/auth/reset-password",{email:t,newPassword:o,code:n});return a}async function We(t,o){const{data:n}=await B.post("/points/redeem",{email:t,key:o});return n}async function jo(t){const{data:o}=await B.post("/ctl/points-keys/config",t);return o}async function Eo(t){const{data:o}=await B.get("/ctl/points-keys/configs",{params:t});return o}async function Do(t,o){const{data:n}=await B.post("/ctl/points-keys/generate",{configId:t,count:o});return n}async function Oo(t){const{data:o}=await B.get("/ctl/points-keys/keys",{params:t});return o}async function qo(t,o){const{data:n}=await B.post("/ctl/points-keys/toggle",{ids:t,enabled:o});return n}async function Bo(){const t={"X-API-Version":"v1"},{data:o}=await B.get("/generative-image/get-task-result",{headers:t}),n=o==null?void 0:o.status,a=o==null?void 0:o.result;return{status:n,result:a?{durationMs:a.duration_ms??a.durationMs,inputTokens:a.input_tokens??a.inputTokens,outputTokens:a.output_tokens??a.outputTokens,images:a.images||[],text:a.text,linkImages:a.link_images??a.linkImages??[]}:void 0}}const cs="coralsum-history",ms=4,me="history",fe="images",be="preview_cache";function xe(){return new Promise((t,o)=>{if(!("indexedDB"in window)){o(new Error("IndexedDB not supported"));return}const n=indexedDB.open(cs,ms);n.onupgradeneeded=()=>{const a=n.result;if(!a.objectStoreNames.contains(me)){const c=a.createObjectStore(me,{keyPath:"id"});c.createIndex("email","email",{unique:!1}),c.createIndex("createdAt","createdAt",{unique:!1})}a.objectStoreNames.contains(fe)||a.createObjectStore(fe,{keyPath:"id"}),a.objectStoreNames.contains(be)||a.createObjectStore(be,{keyPath:"key"}).createIndex("createdAt","createdAt",{unique:!1})},n.onsuccess=()=>t(n.result),n.onerror=()=>o(n.error||new Error("Failed to open DB"))})}function Ce(t){return new Promise((o,n)=>{t.onsuccess=()=>o(t.result),t.onerror=()=>n(t.error)})}function Ie(){var o;const t=(o=crypto==null?void 0:crypto.randomUUID)==null?void 0:o.call(crypto);return t||`h_${Date.now()}_${Math.random().toString(36).slice(2,10)}`}async function He(t){return new Promise((o,n)=>{const a=new FileReader;a.onload=()=>{var c;try{const A=String(a.result||"").split(","),R=((c=A[0].match(/data:(.*);base64/))==null?void 0:c[1])||t.type||"application/octet-stream",D=A[1]||"";o({base64:D,type:R,size:t.size})}catch(f){n(f)}},a.onerror=()=>n(a.error),a.readAsDataURL(t)})}async function Vo(t,o){var n,a,c,f,A;try{const R=((n=o.result)==null?void 0:n.images)||[],D=R.filter(b=>b instanceof Blob),P=[];for(const b of D){const C=`img_${Ie()}`,O=await He(b);P.push({id:C,base64:O.base64,type:O.type,size:O.size})}for(const b of R)if(typeof b=="string"&&b.startsWith("data:"))try{const C=b.indexOf(","),O=b.slice(0,C),I=b.slice(C+1),K=((a=O.match(/data:(.*);base64/))==null?void 0:a[1])||"application/octet-stream",H=`img_${Ie()}`;P.push({id:H,base64:I,type:K,size:0})}catch{}const V=await xe(),U=V.transaction([me,fe],"readwrite"),x=U.objectStore(me),z=U.objectStore(fe),N=[];for(const b of P)N.push(b.id),z.put(b);const S={id:Ie(),email:t||"",createdAt:Date.now(),inputTokens:Number(((c=o.result)==null?void 0:c.inputTokens)||0),outputTokens:Number(((f=o.result)==null?void 0:f.outputTokens)||0),durationMs:Number(((A=o.result)==null?void 0:A.durationMs)||0),imageCount:N.length>0?N.length:R.filter(b=>!!b).length,imageIds:N,prompt:o.prompt,systemPrompt:o.systemPrompt,config:o.config};x.add(S),await new Promise((b,C)=>{U.oncomplete=()=>b(),U.onerror=()=>C(U.error),U.onabort=()=>C(U.error)}),V.close()}catch(R){console.log("Failed to add history",R)}}async function Se(t,o=50,n=0){try{const a=await xe(),c=a.transaction([me,fe],"readonly"),f=c.objectStore(me),A=c.objectStore(fe),R=f.index("email"),D=IDBKeyRange.only(t||"");let P=await Ce(R.getAll(D));Array.isArray(P)||(P=[]),P.sort((x,z)=>z.createdAt-x.createdAt);const V=P.slice(n,n+o),U=[];for(const x of V){const z=[];if(Array.isArray(x.imageIds)&&x.imageIds.length>0)for(const N of x.imageIds){const S=await Ce(A.get(N));if(S!=null&&S.base64&&(S!=null&&S.type))z.push(`data:${S.type};base64,${S.base64}`);else if((S==null?void 0:S.blob)instanceof Blob)try{const b=await He(S.blob);z.push(`data:${b.type};base64,${b.base64}`)}catch{}}U.push({id:x.id,email:x.email,createdAt:x.createdAt,inputTokens:x.inputTokens,outputTokens:x.outputTokens,durationMs:x.durationMs,imageCount:x.imageCount,images:z,prompt:x.prompt,systemPrompt:x.systemPrompt,config:x.config})}return a.close(),U}catch{return[]}}async function Xe(t){const o=await xe(),n=o.transaction([me,fe],"readwrite"),a=n.objectStore(me),c=n.objectStore(fe),f=await Ce(a.get(t));if(f&&Array.isArray(f.imageIds))for(const A of f.imageIds)try{c.delete(A)}catch{}try{a.delete(t)}catch{}await new Promise((A,R)=>{n.oncomplete=()=>A(),n.onerror=()=>R(n.error),n.onabort=()=>R(n.error)}),o.close()}function Ke(t){try{const o=new URL(t,window.location.origin),n=o.searchParams.get("ref"),a=o.searchParams.get("pt");return n?`ref:${n}${a?`|pt:${a}`:""}`:o.toString()}catch{const o=t.indexOf("ref="),n=t.indexOf("&pt="),a=o>=0?decodeURIComponent(t.slice(o+4)):"",c=n>=0?decodeURIComponent(t.slice(n+4)):"";return a?`ref:${a}${c?`|pt:${c}`:""}`:t}}function fs(t){var f;if(typeof t!="string"||!t.startsWith("data:"))return null;const o=t.indexOf(",");if(o<0)return null;const n=t.slice(0,o),a=t.slice(o+1);return{type:((f=n.match(/data:(.*);base64/))==null?void 0:f[1])||"application/octet-stream",base64:a}}async function ps(t,o){const n=fs(o);if(!n)return;const a=Ke(t),c=await xe(),f=c.transaction([be],"readwrite"),A=f.objectStore(be),R=Math.floor(n.base64.length*3/4);A.put({key:a,base64:n.base64,type:n.type,size:R,createdAt:Date.now()}),await new Promise((D,P)=>{f.oncomplete=()=>D(),f.onerror=()=>P(f.error),f.onabort=()=>P(f.error)}),c.close()}async function gs(t){const o=Ke(t),n=await xe(),c=n.transaction([be],"readonly").objectStore(be);let f=null;try{f=await Ce(c.get(o))}catch{}return n.close(),f&&f.base64&&f.type?`data:${f.type};base64,${f.base64}`:null}const vs={class:"relative w-[100vw] h-[100vh] select-none"},hs={class:"absolute top-4 right-4 z-10"},ys={class:"absolute top-8 left-1/2 -translate-x-1/2 z-10 pointer-events-none"},bs={class:"scale-indicator px-3 py-1 rounded-md text-xs"},ws=["src"],xs={class:"pointer-events-none absolute bottom-0 left-0 w-full p-4 pb-12"},ks={class:"pointer-events-auto mx-auto max-w-4xl flex flex-wrap items-center justify-center gap-2"},_s={class:"flex items-center gap-1"},$s={class:"flex items-center gap-1"},Ps={class:"flex items-center gap-1"},Ss={class:"flex items-center gap-1"},Rs={class:"flex items-center gap-1"},Cs={class:"flex items-center gap-1"},Ms={class:"flex items-center gap-1"},Is=Me({__name:"ImagePreviewer",props:{modelValue:{type:Boolean},src:{}},emits:["update:modelValue"],setup(t,{emit:o}){const n=t,a=o,c=Le(),f=w(null),A=w(null),R=w(!0),D=w(n.src),P=w(1),V=w(0),U=w(0),x=w(!1),z=w(!1),N=w(0),S=w(0),b=w(0),C=ce(()=>({transform:`translate(-50%, -50%) translate(${V.value}px, ${U.value}px) scale(${P.value}) rotate(${N.value}deg)`,cursor:x.value?"grabbing":"grab",userSelect:"none"})),O={width:"100vw",height:"100vh",margin:"0",padding:"0",background:"transparent"};function I(g){return Math.min(6,Math.max(.1,g))}function K(g){g||H()}function H(){a("update:modelValue",!1)}function Z(){P.value=1,V.value=0,U.value=0,N.value=0}function ae(){P.value=I(P.value+.2)}function le(){P.value=I(P.value-.2)}function pe(g){const h=g.deltaY>0?-.15:.15;P.value=I(P.value+h)}function ee(){N.value-=90}function te(){N.value+=90}function Y(g){var h,F;x.value=!0,S.value=g.clientX,b.value=g.clientY,z.value=!1,(F=(h=g.target).setPointerCapture)==null||F.call(h,g.pointerId)}function ue(g){if(!x.value)return;const h=g.clientX-S.value,F=g.clientY-b.value;S.value=g.clientX,b.value=g.clientY,V.value+=h,U.value+=F,(Math.abs(h)>2||Math.abs(F)>2)&&(z.value=!0)}function ve(g){x.value=!1;const h=g.target;!z.value&&h===f.value&&H()}function p(){x.value=!1}function l(){R.value=!1;try{if(!D.value.startsWith("data:")){const g=A.value;if(!g||!g.complete||g.naturalWidth===0||g.naturalHeight===0)return;const h=document.createElement("canvas");h.width=g.naturalWidth,h.height=g.naturalHeight;const F=h.getContext("2d");if(!F)return;F.drawImage(g,0,0);const X=h.toDataURL("image/png");X&&X.startsWith("data:")&&ps(n.src,X)}}catch{}}async function v(g){var _e;const h=g.split(","),F=((_e=h[0].match(/data:(.*);base64/))==null?void 0:_e[1])||"image/png",X=atob(h[1]),he=X.length,ke=new Uint8Array(he);for(let ye=0;ye<he;ye++)ke[ye]=X.charCodeAt(ye);return new Blob([ke],{type:F})}async function T(){const g=A.value;if(!g||!g.complete||g.naturalWidth===0||g.naturalHeight===0)return null;const h=document.createElement("canvas");h.width=g.naturalWidth,h.height=g.naturalHeight;const F=h.getContext("2d");if(!F)return null;try{F.drawImage(g,0,0)}catch{return null}return await new Promise(X=>{try{h.toBlob(he=>X(he),"image/png")}catch{X(null)}})}async function J(){try{let g=null;n.src.startsWith("data:")?g=await v(n.src):g=await T(),g&&navigator.clipboard&&"write"in navigator.clipboard&&window.ClipboardItem?(await navigator.clipboard.write([new window.ClipboardItem({[g.type]:g})]),c==null||c.success("已复制到剪贴板")):(await navigator.clipboard.writeText(n.src),c==null||c.success("已复制图片链接"))}catch{c==null||c.error("复制失败")}}async function G(){try{let g=null;n.src.startsWith("data:")?g=await v(n.src):g=await T();const h=document.createElement("a"),F=n.src.split("?")[0].split("/").pop()||"image";if(g){const X=URL.createObjectURL(g);h.href=X,h.download=F,document.body.appendChild(h),h.click(),h.remove(),URL.revokeObjectURL(X)}else h.href=n.src,h.download=F,document.body.appendChild(h),h.click(),h.remove()}catch{c==null||c.error("下载失败")}}ge(()=>n.modelValue,g=>{g&&(R.value=!0,Z(),de())}),ge(()=>n.src,()=>{R.value=!0,D.value=n.src,de()}),Fe(()=>{n.modelValue&&(Z(),de())});async function de(){try{const g=await gs(n.src);g?D.value=g:D.value=n.src}catch{D.value=n.src}}return(g,h)=>(_(),W(e(re),{closable:!1,"mask-closable":!0,show:t.modelValue,"show-icon":!1,style:O,"trap-focus":!1,class:"image-previewer-modal fullscreen","onUpdate:show":K},{default:u(()=>[r("div",vs,[r("div",hs,[i(e(k),{circle:"",class:"close-btn",size:"small",strong:"",onClick:H},{default:u(()=>[i(e(y),{icon:"mdi:close"})]),_:1})]),r("div",ys,[r("div",bs,"缩放 "+j((P.value*100).toFixed(0))+"%",1)]),r("div",{ref_key:"canvasRef",ref:f,class:"absolute inset-0 overflow-hidden bg-transparent",onPointerdown:Y,onPointerleave:p,onPointermove:ue,onPointerup:ve,onWheel:ot(pe,["prevent"])},[r("img",{ref_key:"imgRef",ref:A,src:D.value,style:kt(C.value),class:"absolute top-1/2 left-1/2 will-change-transform",crossorigin:"anonymous",draggable:"false",onLoad:l},null,44,ws),R.value?(_(),W(e(Ae),{key:0,class:"absolute inset-0 grid place-items-center",size:"large"})):q("",!0)],544),r("div",xs,[r("div",ks,[i(e(k),{class:"control-btn",size:"small",strong:"",onClick:le},{default:u(()=>[r("div",_s,[i(e(y),{icon:"mdi:magnify-minus-outline"}),h[0]||(h[0]=r("span",null,"缩小",-1))])]),_:1}),i(e(k),{class:"control-btn",size:"small",strong:"",onClick:ae},{default:u(()=>[r("div",$s,[i(e(y),{icon:"mdi:magnify-plus-outline"}),h[1]||(h[1]=r("span",null,"放大",-1))])]),_:1}),i(e(k),{class:"control-btn",size:"small",strong:"",onClick:Z},{default:u(()=>[r("div",Ps,[i(e(y),{icon:"mdi:restart"}),h[2]||(h[2]=r("span",null,"重置",-1))])]),_:1}),i(e(k),{class:"control-btn",size:"small",strong:"",onClick:ee},{default:u(()=>[r("div",Ss,[i(e(y),{icon:"mdi:rotate-left"}),h[3]||(h[3]=r("span",null,"左旋",-1))])]),_:1}),i(e(k),{class:"control-btn",size:"small",strong:"",onClick:te},{default:u(()=>[r("div",Rs,[i(e(y),{icon:"mdi:rotate-right"}),h[4]||(h[4]=r("span",null,"右旋",-1))])]),_:1}),i(e(k),{class:"control-btn",size:"small",strong:"",onClick:J},{default:u(()=>[r("div",Cs,[i(e(y),{icon:"mdi:content-copy"}),h[5]||(h[5]=r("span",null,"复制",-1))])]),_:1}),i(e(k),{class:"control-btn",size:"small",strong:"",onClick:G},{default:u(()=>[r("div",Ms,[i(e(y),{icon:"mdi:download"}),h[6]||(h[6]=r("span",null,"下载",-1))])]),_:1})])])])]),_:1},8,["show"]))}}),Ge=(t,o)=>{const n=t.__vccOpts||t;for(const[a,c]of o)n[a]=c;return n},Ye=Ge(Is,[["__scopeId","data-v-b788c146"]]),Ls={class:"hidden sm:flex w-14 border-r border-neutral-200 dark:border-neutral-800 flex-col items-center py-3 gap-4 glass bg-white/40 dark:bg-black/30"},As={class:"space-y-3"},Ts={class:"flex gap-2 justify-end"},Us={class:"flex items-center gap-2"},Ns={class:"flex flex-col gap-3"},zs={class:"flex items-center justify-between"},js={class:"text-xs text-neutral-500"},Es={class:"flex items-center gap-2"},Ds={class:"flex items-center gap-1"},Os={key:0,class:"p-6"},qs={key:1,class:"flex flex-col gap-3"},Bs={class:"p-3 flex items-center gap-2"},Vs={class:"flex-1 flex flex-wrap items-center gap-1.5 text-[10px] sm:text-[11px]"},Fs={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800"},Ws={class:"font-semibold tabular-nums"},Hs={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-full bg-fuchsia-50 dark:bg-fuchsia-900/30 text-fuchsia-700 dark:text-fuchsia-300 border border-fuchsia-200 dark:border-fuchsia-800"},Xs={class:"font-semibold tabular-nums"},Ks={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-md border border-dashed border-neutral-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300"},Gs={class:"font-semibold tabular-nums"},Ys={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-md border border-dashed border-neutral-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300"},Zs={class:"font-semibold tabular-nums"},Js={class:"ml-auto text-[11px] text-neutral-500"},Qs={class:"flex items-center gap-2"},ea={class:"flex items-center gap-1"},ta={class:"flex items-center gap-1 text-red-600"},sa={key:0,class:"px-3 pb-3 overflow-hidden"},aa={class:"mt-2 flex flex-wrap justify-center gap-2"},oa=["src","onClick"],na={class:"space-y-3"},ra={class:"flex gap-2 justify-end"},ia=Me({__name:"SideMenu",setup(t){const o=ie(),n=Le(),a=qe(),c=Be(),f=ce(()=>c.name==="ctl-keys");function A(){o.requireProfile()}function R(){a.push("/ctl/keys")}function D(){a.push("/")}const P=w(!1),V=w(""),U=w(!1);function x(){if(!o.profileReady){n.error("请先登录"),o.requireLogin();return}V.value.trim()&&We(o.email,V.value.trim()).then(p=>{o.addPoints(p.pointsAdded),V.value="",P.value=!1}).catch(p=>{const l=p==null?void 0:p.status;l===401||l===403?(n.error("未登录或未授权，请先登录"),o.requireLogin()):l===500?n.error("服务异常，请稍后重试"):n.error((p==null?void 0:p.message)||"兑换失败")})}const z=w(!1),N=w(!1),S=w([]),b=w([]),C=w(new Set),O=w(!1),I=w("");function K(){if(!o.profileReady){n.error("请先登录"),o.requireLogin();return}z.value=!0,H()}async function H(){try{N.value=!0;const p=await Se(o.email||"",100,0);S.value=p;const l=p.map(v=>(v.images||[]).map(T=>{if(T&&typeof T!="string")try{return URL.createObjectURL(T)}catch{return""}return T||""}));b.value=p.map((v,T)=>({...v,urls:l[T]}))}catch{S.value=[],b.value=[]}finally{N.value=!1}}function Z(){try{for(const p of b.value)for(const l of p.urls||[])l&&l.startsWith("blob:")&&URL.revokeObjectURL(l)}catch{}}ge(()=>z.value,p=>{p||Z()});function ae(p){C.value.has(p)?C.value.delete(p):(C.value.clear(),C.value.add(p)),C.value=new Set(C.value)}function le(p){I.value=p,O.value=!0}function pe(){try{o.logout(),n.success("已退出登录")}finally{U.value=!1}}async function ee(p){try{if(p!=null&&p.urls)for(const l of p.urls)l&&typeof l=="string"&&l.startsWith("blob:")&&URL.revokeObjectURL(l);await Xe(p.id),S.value=S.value.filter(l=>l.id!==p.id),b.value=b.value.filter(l=>l.id!==p.id),C.value.delete(p.id),n.success("已删除该条记录")}catch{n.error("删除失败")}}function te(p){const l=new Date(p),v=l.getFullYear(),T=String(l.getMonth()+1).padStart(2,"0"),J=String(l.getDate()).padStart(2,"0"),G=String(l.getHours()).padStart(2,"0"),de=String(l.getMinutes()).padStart(2,"0"),g=String(l.getSeconds()).padStart(2,"0");return`${v}-${T}-${J} ${G}:${de}:${g}`}function Y(p){const l=p/1e3,v=Math.floor(l/3600),T=Math.floor(l%3600/60),J=l%60,G=[];return v>0&&G.push(`${v}h`),(T>0||v>0)&&G.push(`${T}m`),G.push(`${J.toFixed(2)}s`),G.join("")}function ue(p){const l=Math.abs(p);if(l<1e3)return`${p} tokens`;let v=p,T="";l>=1e9?(v=p/1e9,T="B"):l>=1e6?(v=p/1e6,T="M"):(v=p/1e3,T="k");const J=v>=100?0:v>=10?1:2;return`${Number(v.toFixed(J)).toString()}${T} tokens`}function ve(p){return`https://placehold.co/512x320?text=IMG${p+1}`}return(p,l)=>(_(),E("div",Ls,[e(o).profileReady?(_(),W(e(ne),{key:0,placement:"right"},{trigger:u(()=>[i(e(k),{circle:"",quaternary:"",onClick:A},{default:u(()=>[i(e(y),{class:"text-xl",icon:"mdi:account-cog"})]),_:1})]),default:u(()=>[l[11]||(l[11]=L(" 用户信息 ",-1))]),_:1})):q("",!0),e(o).profileReady&&(e(o).permissions||[]).includes("CTL")?(_(),W(e(ne),{key:1,placement:"right"},{trigger:u(()=>[i(e(k),{circle:"",quaternary:"",onClick:l[0]||(l[0]=v=>f.value?D():R())},{default:u(()=>[i(e(y),{icon:f.value?"mdi:image":"mdi:key-chain",class:"text-xl"},null,8,["icon"])]),_:1})]),default:u(()=>[L(" "+j(f.value?"图片生成":"密钥管理"),1)]),_:1})):q("",!0),e(o).profileReady?(_(),W(e(ne),{key:2,placement:"right"},{trigger:u(()=>[i(e(k),{circle:"",quaternary:"",onClick:l[1]||(l[1]=v=>P.value=!0)},{default:u(()=>[i(e(y),{class:"text-xl",icon:"mdi:key"})]),_:1})]),default:u(()=>[l[12]||(l[12]=L(" 兑换密钥 ",-1))]),_:1})):q("",!0),e(o).profileReady?(_(),W(e(ne),{key:3,placement:"right"},{trigger:u(()=>[i(e(k),{circle:"",quaternary:"",onClick:K},{default:u(()=>[i(e(y),{class:"text-xl",icon:"mdi:history"})]),_:1})]),default:u(()=>[l[13]||(l[13]=L(" 历史记录 ",-1))]),_:1})):q("",!0),e(o).profileReady?q("",!0):(_(),W(e(ne),{key:4,placement:"right"},{trigger:u(()=>[i(e(k),{circle:"",quaternary:"",onClick:l[2]||(l[2]=v=>e(o).requireLogin())},{default:u(()=>[i(e(y),{class:"text-xl",icon:"mdi:account-arrow-right"})]),_:1})]),default:u(()=>[l[14]||(l[14]=L(" 登录 ",-1))]),_:1})),e(o).profileReady?(_(),W(e(ne),{key:5,placement:"right"},{trigger:u(()=>[i(e(k),{circle:"",quaternary:"",onClick:l[3]||(l[3]=v=>U.value=!0)},{default:u(()=>[i(e(y),{class:"text-xl",icon:"mdi:logout"})]),_:1})]),default:u(()=>[l[15]||(l[15]=L(" 退出登录 ",-1))]),_:1})):q("",!0),i(e(re),{show:P.value,"onUpdate:show":l[6]||(l[6]=v=>P.value=v),style:{width:"420px",maxWidth:"92vw",margin:"0 auto"},preset:"card",title:"兑换积分密钥"},{default:u(()=>[r("div",As,[i(e(oe),{value:V.value,"onUpdate:value":l[4]||(l[4]=v=>V.value=v),placeholder:"输入密钥"},null,8,["value"]),r("div",Ts,[i(e(k),{onClick:l[5]||(l[5]=v=>P.value=!1)},{default:u(()=>[...l[16]||(l[16]=[L("取消",-1)])]),_:1}),i(e(k),{type:"primary",onClick:x},{default:u(()=>[...l[17]||(l[17]=[L("兑换",-1)])]),_:1})])])]),_:1},8,["show"]),i(e(re),{show:z.value,"onUpdate:show":l[8]||(l[8]=v=>z.value=v),style:{width:"min(96vw, 980px)",margin:"0 auto"},preset:"card"},{header:u(()=>[r("div",Us,[l[19]||(l[19]=r("span",null,"历史记录",-1)),i(e(ne),{placement:"top"},{trigger:u(()=>[i(e(y),{class:"text-amber-500 dark:text-amber-400 text-[1rem]",icon:"ph:warning"})]),default:u(()=>[l[18]||(l[18]=L(" 请注意：历史记录保存在您的浏览器本地，不会上传到服务器。更换设备或清理浏览器数据可能会丢失历史。 ",-1))]),_:1})])]),default:u(()=>[r("div",Ns,[r("div",zs,[r("div",js,"共 "+j(S.value.length)+" 条",1),r("div",Es,[i(e(k),{quaternary:"",size:"small",onClick:H},{default:u(()=>[r("div",Ds,[i(e(y),{icon:"mdi:refresh"}),l[20]||(l[20]=r("span",null,"刷新",-1))])]),_:1})])]),i(e(Ae),{show:N.value},{default:u(()=>[S.value.length===0?(_(),E("div",Os,[...l[21]||(l[21]=[r("div",{class:"text-center text-neutral-500"},"暂无历史记录",-1)])])):(_(),E("div",qs,[(_(!0),E(we,null,Re(b.value,v=>(_(),E("div",{key:v.id,class:"rounded border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-black/30 overflow-hidden"},[r("div",Bs,[r("div",Vs,[r("div",Fs,[i(e(y),{class:"text-[0.75rem]",icon:"ph:code"}),l[22]||(l[22]=r("span",{class:"font-medium"},"输入",-1)),r("span",Ws,j(ue(v.inputTokens)),1)]),r("div",Hs,[i(e(y),{class:"text-[0.75rem]",icon:"ph:sparkle"}),l[23]||(l[23]=r("span",{class:"font-medium"},"输出",-1)),r("span",Xs,j(ue(v.outputTokens)),1)]),r("div",Ks,[i(e(y),{class:"text-[0.75rem]",icon:"ph:timer"}),l[24]||(l[24]=r("span",{class:"font-medium"},"耗时",-1)),r("span",Gs,j(Y(v.durationMs)),1)]),r("div",Ys,[i(e(y),{class:"text-[0.75rem]",icon:"ph:image"}),l[25]||(l[25]=r("span",{class:"font-medium"},"图片",-1)),r("span",Zs,j(v.imageCount),1)]),r("div",Js,j(te(v.createdAt)),1)]),r("div",Qs,[i(e(k),{quaternary:"",size:"small",onClick:T=>ae(v.id)},{default:u(()=>[r("div",ea,[i(e(y),{icon:C.value.has(v.id)?"mdi:chevron-up":"mdi:chevron-down"},null,8,["icon"]),l[26]||(l[26]=r("span",null,"展开图片",-1))])]),_:2},1032,["onClick"]),i(e(Ve),{"show-icon":!1,"negative-text":"取消","positive-text":"删除",onPositiveClick:T=>ee(v)},{trigger:u(()=>[i(e(k),{quaternary:"",size:"small"},{default:u(()=>[r("div",ta,[i(e(y),{icon:"mdi:delete-outline"}),l[27]||(l[27]=r("span",null,"删除",-1))])]),_:1})]),default:u(()=>[l[28]||(l[28]=L(" 确认删除该条历史记录？ ",-1))]),_:1},8,["onPositiveClick"])])]),i(De,{name:"expand"},{default:u(()=>{var T;return[C.value.has(v.id)&&((T=v.urls)!=null&&T.length)?(_(),E("div",sa,[r("div",aa,[(_(!0),E(we,null,Re(v.urls,(J,G)=>(_(),E("div",{key:G,class:"rounded bg-neutral-100 dark:bg-neutral-800 w-full sm:w-[200px] md:w-[280px] lg:w-[360px] cursor-zoom-in"},[r("img",{src:J||ve(G),class:"w-full h-auto object-contain",onClick:de=>le(J)},null,8,oa)]))),128))])])):q("",!0)]}),_:2},1024)]))),128))]))]),_:1},8,["show"])]),i(Ye,{modelValue:O.value,"onUpdate:modelValue":l[7]||(l[7]=v=>O.value=v),src:I.value},null,8,["modelValue","src"])]),_:1},8,["show"]),i(e(re),{show:U.value,"onUpdate:show":l[10]||(l[10]=v=>U.value=v),style:{width:"420px",maxWidth:"92vw",margin:"0 auto"},preset:"card",title:"退出登录"},{default:u(()=>[r("div",na,[l[31]||(l[31]=r("div",null,"确定要退出登录吗？",-1)),r("div",ra,[i(e(k),{onClick:l[9]||(l[9]=v=>U.value=!1)},{default:u(()=>[...l[29]||(l[29]=[L("取消",-1)])]),_:1}),i(e(k),{type:"error",onClick:pe},{default:u(()=>[...l[30]||(l[30]=[L("确认退出",-1)])]),_:1})])])]),_:1},8,["show"])]))}}),la=Ge(ia,[["__scopeId","data-v-20ca0ffe"]]),Ze=Oe("settings",{state:()=>({candidateRadio:1,aspectRatio:"auto",candidateSlider:0,topP:.95,temperature:1,resolution:"1x",outputFormat:"PNG",imageSize:"1K",mediaResolution:"auto",darkMode:!1,advancedExpanded:!1}),actions:{toggleDark(){this.darkMode=!this.darkMode},reset(){this.candidateRadio=1,this.aspectRatio="auto",this.candidateSlider=0,this.topP=.95,this.temperature=1,this.resolution="1x",this.outputFormat="PNG",this.imageSize="1K",this.mediaResolution="auto"}}}),ua={class:"h-14 border-b border-transparent px-3 sm:px-4 flex items-center justify-between glass bg-white/40 dark:bg-black/30"},da={class:"font-medium text-neutral-700 dark:text-neutral-200 flex items-center gap-2"},ca={class:"flex items-center gap-2 sm:gap-3 flex-wrap text-sm"},ma={class:"hidden sm:flex items-center gap-2"},fa={class:"font-bold text-neutral-700 dark:text-neutral-200"},pa={key:0,class:"font-medium text-neutral-400 dark:text-neutral-500"},ga={class:"flex items-center gap-1"},va={class:"inline-block underline underline-offset-2 decoration-[1px] decoration-solid"},ha={class:"text-xs text-white space-y-1"},ya={class:"flex items-center gap-2"},ba={class:"sm:hidden w-full px-3 py-2 flex items-center justify-between glass bg-white/60 dark:bg-black/30 border-b border-neutral-200 dark:border-neutral-800"},wa={class:"flex items-center gap-2 min-w-0"},xa={class:"truncate max-w-[40vw] font-bold text-neutral-700 dark:text-neutral-200"},ka={key:0,class:"font-medium text-neutral-400 dark:text-neutral-500"},_a={key:0,class:"flex items-center gap-1"},$a={class:"inline-block underline underline-offset-2 decoration-[1px] decoration-solid"},Pa={class:"space-y-3"},Sa={class:"text-sm text-neutral-500"},Ra={class:"space-y-2"},Ca={class:"flex items-center gap-2"},Ma={class:"flex gap-2 justify-end"},Ia={class:"space-y-3"},La={class:"flex gap-2 justify-end"},Aa={class:"space-y-3"},Ta={class:"flex gap-2 justify-between items-center"},Ua={class:"flex gap-2"},Na={class:"flex gap-2"},za={class:"flex items-center gap-2"},ja={class:"flex flex-col gap-3"},Ea={class:"flex items-center justify-between"},Da={class:"text-xs text-neutral-500"},Oa={class:"flex items-center gap-2"},qa={class:"flex items-center gap-1"},Ba={key:0,class:"p-6"},Va={key:1,class:"flex flex-col gap-3"},Fa={class:"p-3 flex items-center gap-2"},Wa={class:"flex-1 flex flex-wrap items-center gap-1.5 text-[10px] sm:text-[11px]"},Ha={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 border border-blue-200 dark:border-blue-800"},Xa={class:"font-semibold tabular-nums"},Ka={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-full bg-fuchsia-50 dark:bg-fuchsia-900/30 text-fuchsia-700 dark:text-fuchsia-300 border border-fuchsia-200 dark:border-fuchsia-800"},Ga={class:"font-semibold tabular-nums"},Ya={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-md border border-dashed border-neutral-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300"},Za={class:"font-semibold tabular-nums"},Ja={class:"flex items-center gap-0.5 px-1 py-0.5 rounded-md border border-dashed border-neutral-300 dark:border-neutral-700 text-neutral-700 dark:text-neutral-300"},Qa={class:"font-semibold tabular-nums"},eo={class:"ml-auto text-[11px] text-neutral-500"},to={class:"flex items-center gap-2"},so={class:"flex items-center gap-1"},ao={class:"flex items-center gap-1 text-red-600"},oo={key:0,class:"px-3 pb-3 overflow-hidden"},no={class:"mt-2 flex flex-wrap justify-center gap-2"},ro=["src","onClick"],io={class:"space-y-3"},lo={class:"flex gap-2 justify-end"},uo=Me({__name:"TopBar",setup(t){const o=Ze(),n=qe(),a=ie(),c=Le(),f=_t({email:"",password:""}),A=w(null),R=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/,D=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,16}$/,P={email:[{required:!0,message:"请输入邮箱",trigger:["input","blur"]},{validator:(d,s)=>R.test(String(s||"")),message:"邮箱格式不正确",trigger:["input","blur"]}],password:[{required:!0,message:"请输入密码",trigger:["input","blur"]},{validator:(d,s)=>D.test(String(s||"")),message:"密码需6-16位且含字母与数字",trigger:["input","blur"]}]},V=ce(()=>R.test(f.email.trim())&&D.test(f.password.trim())),U=ce(()=>a.name||a.email||"未登录"),x=ce(()=>{const d=String(U.value||""),s=a.profileReady&&typeof a.nickTag=="number"?String(a.nickTag).padStart(4,"0"):"";return{base:d,tag:s}}),z=ce(()=>{const d=o.darkMode,s=a.tier;return s==="FREE"?d?{color:"#0000",textColor:"#e5e7eb",borderColor:"rgba(255,255,255,0.24)"}:{color:"#0000",textColor:"#6b7280",borderColor:"rgba(0,0,0,0.18)"}:s==="PLUS"?d?{color:"rgba(16,185,129,0.18)",textColor:"#2dd4bf",borderColor:"#2dd4bf"}:{color:"rgba(16,185,129,0.10)",textColor:"#10b981",borderColor:"#34d399"}:d?{color:"rgba(139,92,246,0.18)",textColor:"#a78bfa",borderColor:"#a78bfa"}:{color:"rgba(139,92,246,0.10)",textColor:"#8b5cf6",borderColor:"#a78bfa"}}),N=w(!1),S=w(!1),b=w(!1),C=w(0),O=w(x.value.base),I=w(""),K=w(""),H=w(""),Z=w(""),ae=w(""),le=w(!1),pe=w(!1),ee=w([]),te=w([]),Y=w(new Set),ue=w(!1),ve=w(""),p=w(0),l=w(!1);function v(d){o.darkMode=d,document.documentElement.classList.toggle("dark",d)}async function T(){const d=a.email;if(d){if(!R.test(d)){c.error("邮箱格式不正确");return}await rs(d,"RESET")}}async function J(){try{if(b.value)return;if(!V.value){c.error("请检查输入项");return}b.value=!0;const d=await is(f.email.trim(),f.password.trim());a.token=d.access_token;let s;try{s=await Pe()}catch{s=await ls()}a.setProfile({...s,token:d.access_token}),a.showLoginModal=!1,f.email="",f.password="",c.success("登录成功")}catch(d){const s=d==null?void 0:d.status;s===401||s===403?(c.error("未登录或未授权，请先登录"),a.requireLogin()):s===500?c.error("服务异常，请稍后重试"):c.error((d==null?void 0:d.message)||"登录失败")}finally{b.value=!1}}function G(){a.showLoginModal=!1,n.push("/register")}function de(){a.showLoginModal=!1,n.push("/forgot")}async function g(){if(!a.profileReady){c.error("请先登录"),a.requireLogin();return}const d=O.value.trim(),s=!!d&&d!==a.name,m=!!(I.value||K.value||H.value||Z.value);try{if(m){if(!I.value||!K.value||!H.value||!Z.value){c.error("请完整填写原密码、新密码、确认密码与邮箱验证码");return}if(K.value.length<6){c.error("新密码长度需至少 6 位");return}if(K.value!==H.value){c.error("两次输入的新密码不一致");return}await ds(a.email,I.value.trim(),K.value.trim(),Z.value.trim()),I.value="",K.value="",H.value="",Z.value=""}if(s){await us(d);const M=await Pe();a.setProfile({...M})}if(!m&&!s){c.warning("未检测到可保存的更改");return}a.showProfileModal=!1,c.success("已保存用户信息")}catch(M){const Q=M==null?void 0:M.status;Q===401||Q===403?(c.error("未登录或未授权，请先登录"),a.requireLogin()):Q===500?c.error("服务异常，请稍后重试"):c.error((M==null?void 0:M.message)||"保存失败")}}function h(){if(!a.profileReady){c.error("请先登录"),a.requireLogin();return}ae.value.trim()&&We(a.email,ae.value.trim()).then(d=>{a.addPoints(d.pointsAdded),ae.value="",N.value=!1}).catch(d=>{const s=d==null?void 0:d.status;s===401||s===403?(c.error("未登录或未授权，请先登录"),a.requireLogin()):s===500?c.error("服务异常，请稍后重试"):c.error((d==null?void 0:d.message)||"兑换失败")})}Fe(async()=>{a.init(),C.value=0;try{const d=await Pe();a.setProfile({...d,token:a.token})}catch{a.profileReady||a.requireLogin()}if(a.profileReady&&a.email)try{const d=await Se(a.email||"",100,0);p.value=Array.isArray(d)?d.length:0}catch{p.value=0}}),ge(()=>a.points,(d,s)=>{typeof s=="number"&&(C.value=s)}),ge(()=>a.email,async d=>{if(a.profileReady&&d)try{const s=await Se(a.email||"",100,0);p.value=Array.isArray(s)?s.length:0}catch{p.value=0}else p.value=0}),ge(()=>a.showProfileModal,d=>{d&&(O.value=x.value.base)});function F(){if(!a.profileReady){c.error("请先登录"),a.requireLogin();return}le.value=!0,X()}async function X(){try{pe.value=!0;const d=await Se(a.email||"",100,0);ee.value=d,p.value=Array.isArray(d)?d.length:0;const s=d.map(m=>(m.images||[]).map(M=>{if(M&&typeof M!="string")try{return URL.createObjectURL(M)}catch{return""}return M||""}));te.value=d.map((m,M)=>({...m,urls:s[M]}))}catch{ee.value=[],te.value=[],p.value=0}finally{pe.value=!1}}function he(){try{for(const d of te.value)for(const s of d.urls||[])s&&s.startsWith("blob:")&&URL.revokeObjectURL(s)}catch{}}ge(()=>le.value,d=>{d||he()});function ke(d){Y.value.has(d)?Y.value.delete(d):(Y.value.clear(),Y.value.add(d)),Y.value=new Set(Y.value)}function _e(d){ve.value=d,ue.value=!0}function ye(){try{a.logout(),c.success("已退出登录")}finally{l.value=!1}}async function Qe(d){try{if(d!=null&&d.urls)for(const s of d.urls)s&&typeof s=="string"&&s.startsWith("blob:")&&URL.revokeObjectURL(s);await Xe(d.id),ee.value=ee.value.filter(s=>s.id!==d.id),te.value=te.value.filter(s=>s.id!==d.id),Y.value.delete(d.id),p.value=ee.value.length,c.success("已删除该条记录")}catch{c.error("删除失败")}}function et(d){const s=new Date(d),m=s.getFullYear(),M=String(s.getMonth()+1).padStart(2,"0"),Q=String(s.getDate()).padStart(2,"0"),se=String(s.getHours()).padStart(2,"0"),Ne=String(s.getMinutes()).padStart(2,"0"),at=String(s.getSeconds()).padStart(2,"0");return`${m}-${M}-${Q} ${se}:${Ne}:${at}`}function tt(d){const s=d/1e3,m=Math.floor(s/3600),M=Math.floor(s%3600/60),Q=s%60,se=[];return m>0&&se.push(`${m}h`),(M>0||m>0)&&se.push(`${M}m`),se.push(`${Q.toFixed(2)}s`),se.join("")}function Ue(d){const s=Math.abs(d);if(s<1e3)return`${d} tokens`;let m=d,M="";s>=1e9?(m=d/1e9,M="B"):s>=1e6?(m=d/1e6,M="M"):(m=d/1e3,M="k");const Q=m>=100?0:m>=10?1:2;return`${Number(m.toFixed(Q)).toString()}${M} tokens`}function st(d){return`https://placehold.co/512x320?text=IMG${d+1}`}return(d,s)=>(_(),E(we,null,[r("div",ua,[r("div",da,[i(e(y),{class:"text-xl",icon:"solar:stars-bold-duotone"}),s[22]||(s[22]=r("span",null,"Coralsum 生图",-1))]),r("div",ca,[r("div",ma,[i(e(y),{class:"text-lg",icon:"mdi:account"}),r("span",fa,[L(j(x.value.base),1),x.value.tag?(_(),E("span",pa,"#"+j(x.value.tag),1)):q("",!0)]),e(a).profileReady?(_(),W(e(ne),{key:0,placement:"bottom",trigger:"hover"},{trigger:u(()=>[r("div",ga,[i(e(y),{class:"text-yellow-500 text-base",icon:"material-symbols:bolt-rounded"}),r("span",va,[i(e(ze),{active:!0,duration:800,from:C.value,precision:0,to:e(a).points},null,8,["from","to"])])])]),default:u(()=>[r("div",ha,[r("div",null,"订阅积分："+j(e(a).subscribePoints),1),r("div",null,"永久积分："+j(e(a).permanentPoints),1)])]),_:1})):q("",!0),e(a).profileReady?(_(),W(e(je),{key:1,color:z.value,class:"inline-flex items-center justify-center leading-none",size:"small"},{default:u(()=>[L(j(e(a).tier),1)]),_:1},8,["color"])):q("",!0)]),r("div",ya,[e(a).profileReady?(_(),W(e(k),{key:0,circle:"",class:"sm:hidden",quaternary:"",size:"small",onClick:s[0]||(s[0]=m=>e(a).requireProfile())},{default:u(()=>[i(e(y),{icon:"mdi:account-cog"})]),_:1})):q("",!0),e(a).profileReady?(_(),W(e(k),{key:1,circle:"",class:"sm:hidden",quaternary:"",size:"small",onClick:s[1]||(s[1]=m=>N.value=!0)},{default:u(()=>[i(e(y),{icon:"mdi:key"})]),_:1})):q("",!0),e(a).profileReady?(_(),W(e(dt),{key:2,show:p.value>0,value:p.value,class:"sm:hidden"},{default:u(()=>[i(e(k),{circle:"",quaternary:"",size:"small",onClick:F},{default:u(()=>[i(e(y),{icon:"mdi:history"})]),_:1})]),_:1},8,["show","value"])):q("",!0),e(a).profileReady?q("",!0):(_(),W(e(k),{key:3,circle:"",class:"sm:hidden",quaternary:"",size:"small",onClick:s[2]||(s[2]=m=>e(a).requireLogin())},{default:u(()=>[i(e(y),{icon:"mdi:account-arrow-right"})]),_:1})),e(a).profileReady?(_(),W(e(k),{key:4,circle:"",class:"sm:hidden",quaternary:"",size:"small",onClick:s[3]||(s[3]=m=>l.value=!0)},{default:u(()=>[i(e(y),{icon:"mdi:logout"})]),_:1})):q("",!0),i(e(ct),{value:e(o).darkMode,"onUpdate:value":v},{checked:u(()=>[i(e(y),{icon:"mdi:weather-night"})]),unchecked:u(()=>[i(e(y),{icon:"mdi:white-balance-sunny"})]),_:1},8,["value"])])])]),r("div",ba,[r("div",wa,[i(e(y),{class:"text-base",icon:"mdi:account"}),r("span",xa,[L(j(x.value.base),1),x.value.tag?(_(),E("span",ka,"#"+j(x.value.tag),1)):q("",!0)]),e(a).profileReady?(_(),E("div",_a,[i(e(y),{class:"text-yellow-500",icon:"material-symbols:bolt-rounded"}),r("span",$a,[i(e(ze),{active:!0,duration:800,from:C.value,precision:0,to:e(a).points},null,8,["from","to"])])])):q("",!0),e(a).profileReady?(_(),W(e(je),{key:1,color:z.value,class:"inline-flex items-center justify-center leading-none",size:"small"},{default:u(()=>[L(j(e(a).tier),1)]),_:1},8,["color"])):q("",!0)])]),i(e(re),{show:e(a).showProfileModal,"onUpdate:show":s[10]||(s[10]=m=>e(a).showProfileModal=m),style:{width:"520px",maxWidth:"92vw",margin:"0 auto"},preset:"card",title:"用户信息"},{default:u(()=>[r("div",Pa,[r("div",Sa,"邮箱："+j(e(a).email),1),i(e(oe),{value:O.value,"onUpdate:value":s[4]||(s[4]=m=>O.value=m),placeholder:"名称"},null,8,["value"]),i(e(mt),null,{default:u(()=>[i(e(ft),{name:"pwd",title:"修改密码"},{default:u(()=>[r("div",Ra,[i(e(oe),{value:I.value,"onUpdate:value":s[5]||(s[5]=m=>I.value=m),placeholder:"原密码",type:"password"},null,8,["value"]),i(e(oe),{value:K.value,"onUpdate:value":s[6]||(s[6]=m=>K.value=m),placeholder:"新密码",type:"password"},null,8,["value"]),i(e(oe),{value:H.value,"onUpdate:value":s[7]||(s[7]=m=>H.value=m),placeholder:"确认密码",type:"password"},null,8,["value"]),r("div",Ca,[i(e(oe),{value:Z.value,"onUpdate:value":s[8]||(s[8]=m=>Z.value=m),placeholder:"邮箱验证码"},null,8,["value"]),i(e(k),{size:"small",tertiary:"",onClick:T},{default:u(()=>[...s[23]||(s[23]=[L("发送验证码",-1)])]),_:1})])])]),_:1})]),_:1}),r("div",Ma,[i(e(k),{onClick:s[9]||(s[9]=m=>e(a).showProfileModal=!1)},{default:u(()=>[...s[24]||(s[24]=[L("取消",-1)])]),_:1}),i(e(k),{type:"primary",onClick:g},{default:u(()=>[...s[25]||(s[25]=[L("保存",-1)])]),_:1})])])]),_:1},8,["show"]),i(e(re),{show:N.value,"onUpdate:show":s[13]||(s[13]=m=>N.value=m),style:{width:"420px",maxWidth:"92vw",margin:"0 auto"},preset:"card",title:"兑换积分密钥"},{default:u(()=>[r("div",Ia,[i(e(oe),{value:ae.value,"onUpdate:value":s[11]||(s[11]=m=>ae.value=m),placeholder:"输入密钥"},null,8,["value"]),r("div",La,[i(e(k),{onClick:s[12]||(s[12]=m=>N.value=!1)},{default:u(()=>[...s[26]||(s[26]=[L("取消",-1)])]),_:1}),i(e(k),{type:"primary",onClick:h},{default:u(()=>[...s[27]||(s[27]=[L("兑换",-1)])]),_:1})])])]),_:1},8,["show"]),i(e(re),{show:e(a).showLoginModal,"onUpdate:show":s[17]||(s[17]=m=>e(a).showLoginModal=m),style:{width:"520px",maxWidth:"92vw",margin:"0 auto"},preset:"card",title:"登录"},{default:u(()=>[i(e(pt),{ref_key:"formRef",ref:A,model:f,rules:P},{default:u(()=>[r("div",Aa,[i(e(Ee),{path:"email"},{default:u(()=>[i(e(oe),{value:f.email,"onUpdate:value":s[14]||(s[14]=m=>f.email=m),placeholder:"邮箱"},null,8,["value"])]),_:1}),i(e(Ee),{path:"password"},{default:u(()=>[i(e(oe),{value:f.password,"onUpdate:value":s[16]||(s[16]=m=>f.password=m),type:S.value?"text":"password",maxlength:"16",placeholder:"密码"},{suffix:u(()=>[i(e(y),{icon:S.value?"mdi:eye-off-outline":"mdi:eye-outline",class:"cursor-pointer text-neutral-400",onClick:s[15]||(s[15]=m=>S.value=!S.value)},null,8,["icon"])]),_:1},8,["value","type"])]),_:1}),r("div",Ta,[r("div",Ua,[i(e(k),{quaternary:"",onClick:G},{default:u(()=>[...s[28]||(s[28]=[L("注册",-1)])]),_:1}),i(e(k),{quaternary:"",onClick:de},{default:u(()=>[...s[29]||(s[29]=[L("忘记密码",-1)])]),_:1})]),r("div",Na,[i(e(k),{disabled:!V.value,loading:b.value,type:"primary",onClick:J},{default:u(()=>[...s[30]||(s[30]=[L("登录",-1)])]),_:1},8,["disabled","loading"])])])])]),_:1},8,["model"])]),_:1},8,["show"]),i(e(re),{show:le.value,"onUpdate:show":s[19]||(s[19]=m=>le.value=m),style:{width:"min(96vw, 980px)",margin:"0 auto"},preset:"card"},{header:u(()=>[r("div",za,[s[32]||(s[32]=r("span",null,"历史记录",-1)),i(e(ne),{placement:"top"},{trigger:u(()=>[i(e(y),{class:"text-amber-500 dark:text-amber-400 text-[1rem]",icon:"ph:warning"})]),default:u(()=>[s[31]||(s[31]=L(" 请注意：历史记录保存在您的浏览器本地，不会上传到服务器。更换设备或清理浏览器数据可能会丢失历史。 ",-1))]),_:1})])]),default:u(()=>[r("div",ja,[r("div",Ea,[r("div",Da,"共 "+j(ee.value.length)+" 条",1),r("div",Oa,[i(e(k),{quaternary:"",size:"small",onClick:X},{default:u(()=>[r("div",qa,[i(e(y),{icon:"mdi:refresh"}),s[33]||(s[33]=r("span",null,"刷新",-1))])]),_:1})])]),i(e(Ae),{show:pe.value},{default:u(()=>[ee.value.length===0?(_(),E("div",Ba,[...s[34]||(s[34]=[r("div",{class:"text-center text-neutral-500"},"暂无历史记录",-1)])])):(_(),E("div",Va,[(_(!0),E(we,null,Re(te.value,m=>(_(),E("div",{key:m.id,class:"rounded border border-neutral-200 dark:border-neutral-800 bg-white/60 dark:bg-black/30 overflow-hidden"},[r("div",Fa,[r("div",Wa,[r("div",Ha,[i(e(y),{class:"text-[0.75rem]",icon:"ph:code"}),s[35]||(s[35]=r("span",{class:"font-medium"},"输入",-1)),r("span",Xa,j(Ue(m.inputTokens)),1)]),r("div",Ka,[i(e(y),{class:"text-[0.75rem]",icon:"ph:sparkle"}),s[36]||(s[36]=r("span",{class:"font-medium"},"输出",-1)),r("span",Ga,j(Ue(m.outputTokens)),1)]),r("div",Ya,[i(e(y),{class:"text-[0.75rem]",icon:"ph:timer"}),s[37]||(s[37]=r("span",{class:"font-medium"},"耗时",-1)),r("span",Za,j(tt(m.durationMs)),1)]),r("div",Ja,[i(e(y),{class:"text-[0.75rem]",icon:"ph:image"}),s[38]||(s[38]=r("span",{class:"font-medium"},"图片",-1)),r("span",Qa,j(m.imageCount),1)]),r("div",eo,j(et(m.createdAt)),1)]),r("div",to,[i(e(k),{quaternary:"",size:"small",onClick:M=>ke(m.id)},{default:u(()=>[r("div",so,[i(e(y),{icon:Y.value.has(m.id)?"mdi:chevron-up":"mdi:chevron-down"},null,8,["icon"]),s[39]||(s[39]=r("span",null,"展开图片",-1))])]),_:2},1032,["onClick"]),i(e(Ve),{"show-icon":!1,"negative-text":"取消","positive-text":"删除",onPositiveClick:M=>Qe(m)},{trigger:u(()=>[i(e(k),{quaternary:"",size:"small"},{default:u(()=>[r("div",ao,[i(e(y),{icon:"mdi:delete-outline"}),s[40]||(s[40]=r("span",null,"删除",-1))])]),_:1})]),default:u(()=>[s[41]||(s[41]=L(" 确认删除该条历史记录？ ",-1))]),_:1},8,["onPositiveClick"])])]),i(De,{name:"expand"},{default:u(()=>{var M;return[Y.value.has(m.id)&&((M=m.urls)!=null&&M.length)?(_(),E("div",oo,[r("div",no,[(_(!0),E(we,null,Re(m.urls,(Q,se)=>(_(),E("div",{key:se,class:"rounded bg-neutral-100 dark:bg-neutral-800 w-full sm:w-[200px] md:w-[280px] lg:w-[360px] cursor-zoom-in"},[r("img",{src:Q||st(se),class:"w-full h-auto object-contain",onClick:Ne=>_e(Q)},null,8,ro)]))),128))])])):q("",!0)]}),_:2},1024)]))),128))]))]),_:1},8,["show"])]),i(Ye,{modelValue:ue.value,"onUpdate:modelValue":s[18]||(s[18]=m=>ue.value=m),src:ve.value},null,8,["modelValue","src"])]),_:1},8,["show"]),i(e(re),{show:l.value,"onUpdate:show":s[21]||(s[21]=m=>l.value=m),style:{width:"420px",maxWidth:"92vw",margin:"0 auto"},preset:"card",title:"退出登录"},{default:u(()=>[r("div",io,[s[44]||(s[44]=r("div",null,"确定要退出登录吗？",-1)),r("div",lo,[i(e(k),{onClick:s[20]||(s[20]=m=>l.value=!1)},{default:u(()=>[...s[42]||(s[42]=[L("取消",-1)])]),_:1}),i(e(k),{type:"error",onClick:ye},{default:u(()=>[...s[43]||(s[43]=[L("确认退出",-1)])]),_:1})])])]),_:1},8,["show"])],64))}}),co={key:0,class:"md:h-screen md:overflow-hidden flex tech-bg"},mo={class:"flex-1 flex flex-col md:overflow-hidden"},fo={key:1,class:"min-h-screen tech-bg"},po=Me({__name:"App",setup(t){const o=Ze(),n=ce(()=>o.darkMode?gt:null),a=Be(),c=ce(()=>a.name==="register"||a.name==="forgot");return(f,A)=>{const R=xt("router-view");return _(),W(e(wt),{"date-locale":e(bt),locale:e(yt),theme:n.value},{default:u(()=>[i(e(vt),null,{default:u(()=>[i(e(ht),null,{default:u(()=>[c.value?(_(),E("div",fo,[i(R)])):(_(),E("div",co,[i(la),r("div",mo,[i(uo),i(R)])]))]),_:1})]),_:1})]),_:1},8,["date-locale","locale","theme"])}}}),go=[{path:"/",name:"home",component:()=>$e(()=>import("./ImageGen-DDfivgcX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),import.meta.url)},{path:"/register",name:"register",component:()=>$e(()=>import("./Register-dd-lfQmL.js"),__vite__mapDeps([32,22,3,4,2,5,6,7,1,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,24,25,26,27,28,30,31]),import.meta.url)},{path:"/forgot",name:"forgot",component:()=>$e(()=>import("./ForgotPassword-Cc4WprUU.js"),__vite__mapDeps([33,22,3,4,2,5,6,7,1,8,9,10,11,12,13,14,15,16,17,18,19,20,21,23,24,25,26,27,28,30,31]),import.meta.url)},{path:"/ctl/keys",name:"ctl-keys",component:()=>$e(()=>import("./PointsKeyAdmin-T7Vd4rUA.js"),__vite__mapDeps([34,6,7,1,2,3,4,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,5,23,24,25,26,27,28,30,31]),import.meta.url)}];try{const t=localStorage.getItem("pinia_settings");if(t){const o=JSON.parse(t||"{}"),n=!!(o!=null&&o.darkMode);document.documentElement.classList.toggle("dark",n)}}catch{}$("mdi:account",$t);$("mdi:account-cog",Pt);$("mdi:account-arrow-right",St);$("mdi:logout",Rt);$("mdi:key",Ct);$("mdi:history",Mt);$("mdi:weather-night",It);$("mdi:white-balance-sunny",Lt);$("mdi:refresh",At);$("mdi:chevron-up",Tt);$("mdi:chevron-down",Ut);$("mdi:delete-outline",Nt);$("mdi:eye-off-outline",zt);$("mdi:eye-outline",jt);$("mdi:cloud-upload",Et);$("mdi:reload",Dt);$("mdi:close",Ot);$("mdi:magnify-minus-outline",qt);$("mdi:magnify-plus-outline",Bt);$("mdi:restart",Vt);$("mdi:rotate-left",Ft);$("mdi:rotate-right",Wt);$("mdi:content-copy",Ht);$("mdi:download",Xt);$("mdi:image",Kt);$("mdi:key-chain",Gt);$("material-symbols:bolt-rounded",Yt);$("ph:warning",Zt);$("ph:code",Jt);$("ph:sparkle",Qt);$("ph:timer",es);$("ph:image",ts);$("ph:share",ss);$("ph:info",as);$("solar:stars-bold-duotone",os);const Je=rt();Je.use(ns);const vo=it({history:lt(),routes:go}),Te=nt(po);Te.use(Je);Te.use(vo);Te.mount("#app");const Fo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Ye as I,Ge as _,ie as a,Bo as b,To as c,Ao as d,Vo as e,rs as f,Uo as g,No as h,zo as i,Eo as j,jo as k,Oo as l,Do as m,Fo as n,ls as r,ps as s,qo as t,Ze as u};
