import{u as S}from"./vue-l5MwoWad.js";import{I as C}from"./iconify-Dow0D7fd.js";import{a as h,f as A,i as B}from"./main-kPxSAhoX.js";import{u as L,k as U,l as d,c as p,B as g,y as V}from"./naive-ui-DI5taouS.js";import{f as Z,t as $,P as E,d as r,L as i,M as I,N as v,p as w}from"./@vue/runtime-core-HkD_qmHb.js";import{u as f,o as F,D as o}from"./@vue/reactivity-u6ABGPMg.js";import"./@vue/runtime-dom-hKZGlRKN.js";import"./@vue/shared-B44ZMsZr.js";import"./axios-B9ygI19o.js";import"./index-Sc79Mvov.js";/* empty css                               *//* empty css                                   */import"./@iconify-icons/mdi-DHJ9wI3J.js";import"./@iconify-icons/material-symbols-ysi_2Ggx.js";import"./@iconify-icons/ph-Cp5BnHKQ.js";import"./@iconify-icons/solar-D92Mec1c.js";import"./date-fns-Ddv6U-Yp.js";import"./vooks-CHP5O5D0.js";import"./evtd-CI_DDEu_.js";import"./seemly-D48R1BPg.js";import"./lodash-es-Bym2J9Gs.js";import"./@emotion/hash-WldOFDRm.js";import"./vueuc-CfobdMGE.js";import"./@css-render/vue3-ssr-Dz-R1Ori.js";import"./vdirs-DRH9Xvnd.js";import"./@juggle/resize-observer-C8OzoCMD.js";import"./css-render-CKtry55Z.js";import"./treemate-HRdUPn5m.js";import"./date-fns-tz-7ws4grit.js";import"./async-validator-9PlIezaS.js";import"./@css-render/plugin-bem-Be8eOoM-.js";const j={class:"min-h-screen flex items-center justify-center p-4"},M={class:"space-y-3"},T={class:"flex items-center gap-2"},D={class:"flex gap-2 justify-end"},Ce=Z({__name:"ForgotPassword",setup(G){const x=S(),l=L(),y=h(),k=f(null),t=F({email:"",newPassword:"",confirm:"",code:""}),n=f(!1),u=f(!1),m=f(!1),c=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/,_=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,16}$/,P=/^\d{4,6}$/,N={email:[{required:!0,message:"请输入邮箱",trigger:["input","blur"]},{validator:(s,e)=>c.test(String(e||"")),message:"邮箱格式不正确",trigger:["input","blur"]}],newPassword:[{required:!0,message:"请输入新密码",trigger:["input","blur"]},{validator:(s,e)=>_.test(String(e||"")),message:"密码需6-16位且含字母与数字",trigger:["input","blur"]}],confirm:[{required:!0,message:"请确认密码",trigger:["input","blur"]},{validator:(s,e)=>String(e||"")===t.newPassword,message:"两次输入不一致",trigger:["input","blur"]}],code:[{required:!0,message:"请输入验证码",trigger:["input","blur"]},{validator:(s,e)=>P.test(String(e||"")),message:"验证码为4-6位数字",trigger:["input","blur"]}]},b=$(()=>c.test(t.email.trim())&&_.test(t.newPassword.trim())&&t.confirm===t.newPassword&&P.test(t.code.trim()));async function R(){const s=t.email.trim();if(!c.test(s)){l.error("请先填写正确邮箱");return}await A(s,"RESET")}async function q(){try{if(n.value)return;if(!b.value){l.error("请检查输入项");return}n.value=!0,await B(t.email.trim(),t.newPassword.trim(),t.code.trim()),l.success("重置成功，请登录"),y.requireLogin(),x.push("/")}catch(s){l.error((s==null?void 0:s.message)||"重置失败")}finally{n.value=!1}}function z(){y.requireLogin(),x.push("/")}return(s,e)=>(I(),E("div",j,[r(o(V),{style:{"max-width":"520px",width:"92vw"},title:"忘记密码"},{default:i(()=>[r(o(U),{ref_key:"formRef",ref:k,model:t,rules:N},{default:i(()=>[v("div",M,[r(o(d),{path:"email"},{default:i(()=>[r(o(p),{value:t.email,"onUpdate:value":e[0]||(e[0]=a=>t.email=a),placeholder:"邮箱"},null,8,["value"])]),_:1}),r(o(d),{path:"newPassword"},{default:i(()=>[r(o(p),{value:t.newPassword,"onUpdate:value":e[2]||(e[2]=a=>t.newPassword=a),type:u.value?"text":"password",maxlength:"16",placeholder:"新密码"},{suffix:i(()=>[r(o(C),{icon:u.value?"mdi:eye-off-outline":"mdi:eye-outline",class:"cursor-pointer text-neutral-400",onClick:e[1]||(e[1]=a=>u.value=!u.value)},null,8,["icon"])]),_:1},8,["value","type"])]),_:1}),r(o(d),{path:"confirm"},{default:i(()=>[r(o(p),{value:t.confirm,"onUpdate:value":e[4]||(e[4]=a=>t.confirm=a),type:m.value?"text":"password",maxlength:"16",placeholder:"确认密码"},{suffix:i(()=>[r(o(C),{icon:m.value?"mdi:eye-off-outline":"mdi:eye-outline",class:"cursor-pointer text-neutral-400",onClick:e[3]||(e[3]=a=>m.value=!m.value)},null,8,["icon"])]),_:1},8,["value","type"])]),_:1}),v("div",T,[r(o(d),{class:"flex-1",path:"code"},{default:i(()=>[r(o(p),{value:t.code,"onUpdate:value":e[5]||(e[5]=a=>t.code=a),maxlength:"6",placeholder:"邮箱验证码"},null,8,["value"])]),_:1}),r(o(g),{size:"small",tertiary:"",onClick:R},{default:i(()=>[...e[6]||(e[6]=[w("发送验证码",-1)])]),_:1})]),v("div",D,[r(o(g),{onClick:z},{default:i(()=>[...e[7]||(e[7]=[w("返回登录",-1)])]),_:1}),r(o(g),{disabled:!b.value,loading:n.value,type:"primary",onClick:q},{default:i(()=>[...e[8]||(e[8]=[w("重置密码",-1)])]),_:1},8,["disabled","loading"])])])]),_:1},8,["model"])]),_:1})]))}});export{Ce as default};
